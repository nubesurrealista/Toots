<!DOCTYPE html>
<html>
<head>
    <title>Mis Toots</title>
    <style>
        body {
            font-family: sans-serif;
        }
        a {
            color: #0366d6;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        #rss-content {
          overflow-wrap: break-word;
        }
        #error-message {
          color: red;
        }
        .toot {
            margin-bottom: 1em;
        }
        .toot p {
            margin: 0.5em 0;
        }
        .media-gallery {
            display: flex;
            flex-wrap: wrap;
            gap: 5px; /* Espacio entre imágenes */
        }
        .media-gallery img {
            max-width: 100%; /* Asegura que las imágenes no se desborden */
            height: auto;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>Mis Toots</h1>
    <div id="rss-content">Cargando...</div>
    <div id="error-message"></div>

    <script>
        const instanceURL = 'https://tkz.one';
        const userHandle = 'nubesurrealista';

        function loadToots() {
            const errorDiv = document.getElementById("error-message");
            const contentDiv = document.getElementById("rss-content");
            contentDiv.innerHTML = 'Cargando...';
            errorDiv.innerText = '';

            fetch(`${instanceURL}/api/v1/accounts/lookup?acct=${userHandle}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`Error al buscar la cuenta: ${response.status} ${response.statusText}`);
                    }
                    return response.json();
                })
                .then(account => {
                   if(!account)
                   {
                     throw new Error(`No se encontro la cuenta ${userHandle}`);
                   }
                    const userId = account.id;
                    return fetch(`${instanceURL}/api/v1/accounts/${userId}/statuses?limit=20`);
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`Error al cargar los toots: ${response.status} ${response.statusText}`);
                    }
                    return response.json();
                })
                .then(toots => {
                    contentDiv.innerHTML = '';
                    if (toots && toots.length > 0) {
                        toots.forEach(toot => {
                            const content = toot.content;
                            const createdAt = new Date(toot.created_at).toLocaleString();
                            const url = toot.url;
                            const mediaAttachments = toot.media_attachments;
                            let mediaHtml = '';

                            if (mediaAttachments && mediaAttachments.length > 0) {
                                mediaHtml = '<div class="media-gallery">';
                                mediaAttachments.forEach(media => {
                                    if (media.type === 'image') {
                                        mediaHtml += `<img src="${media.url}" alt="${media.description || 'Imagen adjunta'}">`;
                                    }
                                });
                                mediaHtml += '</div>';
                            }

                            const htmlContent = `<div class="toot">
                                                    <p>${content}</p>
                                                    ${mediaHtml}
                                                    <p><a href="${url}" target="_blank" rel="noopener noreferrer">Publicado el ${createdAt}</a></p>
                                                  </div><hr/>`;
                            contentDiv.innerHTML += htmlContent;
                        });
                    } else {
                        errorDiv.innerText = 'No se encontraron toots.';
                    }
                })
                .catch(error => {
                    console.error("Error:", error);
                    contentDiv.innerHTML = '';
                    errorDiv.innerText = `Error: ${error.message}`;
                });
        }

        window.onload = loadToots;
    </script>
</body>
</html>
